
<!DOCTYPE html><html>
<head>
    <meta http-equiv="Content-Type"
          content="text/html; charset=utf-8"/>
    
        <title>3. Capturing ROOT Errors with rootpy.logger &mdash; rootpy dev documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='http://fonts.googleapis.com/css?family=Crete+Round' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="_static/sphinx-bootstrap.css" type="text/css"/>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css"/>
    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
        <script type="text/javascript">
            var DOCUMENTATION_OPTIONS = {
                URL_ROOT:'',
                VERSION:'dev',
                COLLAPSE_INDEX:false,
                FILE_SUFFIX:'.html',
                HAS_SOURCE:  true
            };
        </script>
            <script type="text/javascript" src="_static/jquery.js"></script>
            <script type="text/javascript" src="_static/underscore.js"></script>
            <script type="text/javascript" src="_static/doctools.js"></script>
            <script type="text/javascript" src="_static/bootstrap-dropdown.js"></script>
        <link rel="top" title="rootpy dev documentation" href="index.html"/>
            <link rel="up" title="&lt;no title&gt;" href="user_guide.html"/>
            <link rel="next" title="4. rootpy Package" href="modules/modules.html"/>
            <link rel="prev" title="2. Getting Started" href="start.html"/> 
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
    
</head>
<body>

    <div class="navbar navbar-static-top">
        <div class="navbar-inner">
            <div class="container">

    <div class="related">
        <ul class="nav">
                <li class=""><a class="brand" href="index.html">rootpy</a></li>
                <li>
                    <a href="genindex.html"
                       title="General Index" accesskey="I">index</a>
                </li>
                <li>
                    <a href="py-modindex.html"
                       title="Python Module Index" >modules</a>
                </li>
                <li>
                    <a href="modules/modules.html"
                       title="4. rootpy Package" accesskey="N">next</a>
                </li>
                <li>
                    <a href="start.html"
                       title="2. Getting Started" accesskey="P">previous</a>
                </li>
                <li><a href="user_guide.html"
                        accesskey="U">&lt;no title&gt;</a>
                </li> 
        </ul>
    </div>
                <div class="pull-right">
                    
        <form class="navbar-search" action="search.html"
              method="get">
            <input type="text" name="q" placeholder="search"/>
            <input type="hidden" name="check_keywords" value="yes"/>
            <input type="hidden" name="area" value="default"/>
        </form>
                </div>
            </div>
        </div>
    </div>


<ul class="quick-links">
    <li><strong>Quick links</strong></li>
    <li>
        <a href="https://github.com/rootpy/rootpy/">GitHub</a>
    </li>
    <li>
        <a href="https://github.com/rootpy/rootpy/issues?state=open">Issues</a>
    </li>
    <li class="divider">&middot;</li>
    <li>
        <iframe class="github-btn"
                src="http://ghbtns.com/github-btn.html?user=rootpy&repo=rootpy&type=watch&count=true"
                allowtransparency="true" frameborder="0" scrolling="0"
                width="110px" height="20px"></iframe>
    </li>
    <li>
        <iframe class="github-btn"
                src="http://ghbtns.com/github-btn.html?user=rootpy&repo=rootpy&type=fork&count=true"
                allowtransparency="true" frameborder="0" scrolling="0"
                width="94px" height="20px"></iframe>
    </li>

    <!--<li class="divider">&middot;</li>
    <li class="follow-btn">
        <a href="https://twitter.com/"
           class="twitter-follow-button" data-width="145px"
           data-link-color="#0069D6" data-show-count="false">Follow
            @</a>
    </li>
    <li class="tweet-btn">
        <a href="https://twitter.com/share" class="twitter-share-button"
           data-url="http://rootpy.org" data-count="horizontal"
           data-via="twbootstrap"
           data-related=":Creator of rootpy">Tweet</a>
       </li>-->
    <li class="plusone-container">
        <g:plusone size="medium"></g:plusone>
    </li>
</ul>  
    <div class="container">
        <div class="content row">
                <div class="span9">
                    
  <div class="section" id="capturing-root-errors-with-rootpy-logger">
<h1>3. Capturing ROOT Errors with <a class="reference internal" href="modules/rootpy.logging.html#module-rootpy.logger" title="rootpy.logger"><tt class="xref py py-mod docutils literal"><span class="pre">rootpy.logger</span></tt></a><a class="headerlink" href="#capturing-root-errors-with-rootpy-logger" title="Permalink to this headline">¶</a></h1>
<p>More detail about ways to use logging can be found in the rootpy logger module,
see <a class="reference internal" href="modules/rootpy.logging.html#module-rootpy.logger" title="rootpy.logger"><tt class="xref py py-mod docutils literal"><span class="pre">rootpy.logger</span></tt></a>.</p>
<p>rootpy provides a mechanism to capture ROOT&#8217;s log messages and if appropriate,
raise an error. This can be a big boon for debugging and makes it possible to
do things which were not previously possible, such as capture messages to show
them where they are needed (think of web services, for example).</p>
<p>As a trivial example, it means that this:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [2]: </span><span class="n">r</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s">&quot;test.root&quot;</span><span class="p">)</span>
<span class="go">Error in &lt;TFile::TFile&gt;: file test.root does not exist</span>

<span class="gp">In [3]: </span><span class="n">r</span><span class="o">.</span><span class="n">myanalysisdata</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">AttributeError                            Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-3-c06f1156de1b&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 r.myanalysisdata</span>

<span class="go">AttributeError: TFile object has no attribute &#39;myanalysisdata&#39;</span>
</pre></div>
</div>
<p>Now does this:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">rootpy</span>
<span class="gp">In [4]: </span><span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">TFile</span><span class="p">(</span><span class="s">&quot;test.root&quot;</span><span class="p">)</span>
<span class="go">&gt; Warning: No logger for &#39;ROOT&#39;, adding a default</span>
<span class="go">&gt;          Suppress with &#39;import logging; logging.basicConfig()&#39;</span>
<span class="go">ERROR:ROOT.TFile.TFile:file test.root does not exist</span>
<span class="go">---------------------------------------------------------------------------</span>
<span class="go">ROOTError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-4-e2c494f4c26e&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 f = ROOT.TFile(&quot;test.root&quot;)</span>

<span class="go">&lt;ipython-input-4-e2c494f4c26e&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 f = ROOT.TFile(&quot;test.root&quot;)</span>

<span class="go">.../rootpy/logger/roothandler.py in python_logging_error_handler(level, abort, location, msg)</span>
<span class="go">     50                         # We can&#39;t raise an exception from here because ctypes/PyROOT swallows it.</span>
<span class="go">     51                         # Hence the need for dark magic, we re-raise it within a trace.</span>
<span class="go">---&gt; 52                         raise ROOTError(level, location, msg)</span>
<span class="go">     53                 except RuntimeError:</span>
<span class="go">     54                         _, exc, traceback = sys.exc_info()</span>

<span class="go">ROOTError: level=3000, loc=&#39;TFile::TFile&#39;, msg=&#39;file test.root does not exist&#39;</span>
</pre></div>
</div>
<p>This means that the code fails early, even better it&#8217;s at the point of the
problem. It uses python&#8217;s logging mechanism, so now it&#8217;s possible to filter
messages with ease.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The astute amongst you might have noticed a passing mention of dark magic. This
feature is still a little experimental, and is currently limited to CPython 2.6-2.7.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If errors don&#8217;t give you backtraces as you expect, it might be necessary to:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">rootpy.logger.magic</span> <span class="kn">as</span> <span class="nn">M</span><span class="p">;</span> <span class="n">M</span><span class="o">.</span><span class="n">DANGER</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
<p>The first thing to note is the warning mentioning a lack of a default logger. To
suppress this, configure logging any way you please, or use the snippet from the
warning itself.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="c"># Most verbose log level</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
<p>Once that is done, you can use python&#8217;s normal logging API to suppress or
highlight log messages coming from particular places with ease:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="c"># Suppress &quot;debug&quot;-level notices from TCanvas that it has saved a .png</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;ROOT.TCanvas&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to get the stack trace at the point where any ROOT message is coming
from, you can decrease the abort level to the minimum:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">ROOT</span>
<span class="n">ROOT</span><span class="o">.</span><span class="n">gErrorAbortLevel</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<div class="section" id="python-logging-module-basics-or-why-haven-t-my-logging-messages-appeared">
<h2>3.1. Python logging module basics, or: why haven&#8217;t my logging messages appeared!?<a class="headerlink" href="#python-logging-module-basics-or-why-haven-t-my-logging-messages-appeared" title="Permalink to this headline">¶</a></h2>
<p>In Python&#8217;s standard library there is a <tt class="docutils literal"><span class="pre">logging</span></tt> module. It&#8217;s good to make
use of this, because it means that you can interoperate with a large range of
tools which already use it. <tt class="xref py py-mod docutils literal"><span class="pre">rootpy</span></tt> extends the default logger to add
a range of useful utilities, but underlying it is the normal logging behaviour.</p>
<p>Python&#8217;s <tt class="docutils literal"><span class="pre">logging</span></tt> module allows you to define a hierarchy of loggers.
Confusingly, the base of the hierarchy is called <tt class="docutils literal"><span class="pre">root</span></tt>. Each logger in a
hierarchy has a <tt class="docutils literal"><span class="pre">.level</span></tt> (one of <tt class="docutils literal"><span class="pre">CRITICAL</span></tt>, <tt class="docutils literal"><span class="pre">ERROR</span></tt>, <tt class="docutils literal"><span class="pre">WARNING</span></tt>,
<tt class="docutils literal"><span class="pre">INFO</span></tt>, <tt class="docutils literal"><span class="pre">DEBUG</span></tt>, <tt class="docutils literal"><span class="pre">NOTSET</span></tt>), which defines the minimum severity of messages
which will be passed onto the handlers.</p>
<p>Handlers can be attached to specific loggers, or anywhere in the hierarchy. For
example, a handler attached to the logger <tt class="docutils literal"><span class="pre">logging.root</span></tt> would recieve all
messages which meet the <tt class="docutils literal"><span class="pre">root</span></tt> logger&#8217;s minimum level.</p>
<p>Handlers have a <tt class="docutils literal"><span class="pre">level</span></tt>, independently of a logger. This means that a handler
can be configured to only receive certain messages.</p>
<p>By default, Python configures no handlers. This means that ordinarily, after
emitting a brief one-time warning about no handlers being configured, messages
get sent into the void, never to be heard from again. In addition, the default
state of the <tt class="docutils literal"><span class="pre">logging.root</span></tt> logger is <tt class="docutils literal"><span class="pre">WARNING</span></tt>, so at first, no messages
less severe than that (<tt class="docutils literal"><span class="pre">INFO</span></tt> and <tt class="docutils literal"><span class="pre">DEBUG</span></tt>) will be processed.</p>
<p>This makes it reasonable to leave <tt class="docutils literal"><span class="pre">log.debug</span></tt> statements in non-performance
critical code, since by default they aren&#8217;t shown.</p>
</div>
<div class="section" id="what-does-rootpy-s-logging-do-for-me">
<h2>3.2. What does rootpy&#8217;s logging do for me?<a class="headerlink" href="#what-does-rootpy-s-logging-do-for-me" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="modules/rootpy.logging.html#module-rootpy.logger" title="rootpy.logger"><tt class="xref py py-mod docutils literal"><span class="pre">rootpy.logger</span></tt></a> adds a check to ensure that a handler is configured
against the <tt class="docutils literal"><span class="pre">rootpy</span></tt> logging namespace and, if not, installs a default one.</p>
<p>There is some syntactic sugar to obtain loggers in a given namespace:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">rootpy</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">rootpy</span><span class="o">.</span><span class="n">log</span> <span class="c"># logger in the rootpy logging namespace</span>
                                 <span class="c"># (whose parent is python&#39;s `logging.root`)</span>

<span class="n">log</span><span class="p">[</span><span class="s">&quot;child&quot;</span><span class="p">]</span> <span class="c"># logger in the rootpy.child namespace</span>
<span class="n">log</span><span class="p">[</span><span class="s">&quot;/ROOT&quot;</span><span class="p">]</span> <span class="c"># ROOT</span>
<span class="n">log</span><span class="p">[</span><span class="s">&quot;/ROOT.TFile&quot;</span><span class="p">]</span> <span class="c"># ROOT.TFile</span>
</pre></div>
</div>
<p><a class="reference internal" href="modules/rootpy.logging.html#module-rootpy.logger" title="rootpy.logger"><tt class="xref py py-mod docutils literal"><span class="pre">rootpy.logger</span></tt></a> can also help you identify <em>where</em> messages are coming
from, using <a class="reference internal" href="modules/rootpy.logging.html#rootpy.logger.extended_logger.ExtendedLogger.showstack" title="rootpy.logger.extended_logger.ExtendedLogger.showstack"><tt class="xref py py-meth docutils literal"><span class="pre">rootpy.logger.extended_logger.ExtendedLogger.showstack()</span></tt></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">log</span><span class="p">[</span><span class="s">&quot;/&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">)</span>
<span class="c"># Show stack traces for</span>
<span class="n">log</span><span class="p">[</span><span class="s">&quot;/ROOT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">showstack</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


                    
                        <div id="disqus_thread"></div>
                        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                    
                </div>
                <div class="span3">
                    
        <div class="sphinxsidebar">
            <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3. Capturing ROOT Errors with <tt class="docutils literal"><span class="pre">rootpy.logger</span></tt></a><ul>
<li><a class="reference internal" href="#python-logging-module-basics-or-why-haven-t-my-logging-messages-appeared">3.1. Python logging module basics, or: why haven&#8217;t my logging messages appeared!?</a></li>
<li><a class="reference internal" href="#what-does-rootpy-s-logging-do-for-me">3.2. What does rootpy&#8217;s logging do for me?</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="start.html"
                        title="previous chapter">2. Getting Started</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="modules/modules.html"
                        title="next chapter">4. rootpy Package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/logger.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
            </div>
        </div>
                </div>
            
        </div>
    </div>
    <div class="footer">
        
        <div class="container">
                    &copy;
                        Copyright 2013, rootpy developers.
                Created using <a
                        href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3
                    .
                <!--Theme <a href="https://github.com/scotch/sphinx-bootstrap">Sphinx-Bootstrap</a>
                adapted from
                <a href="http://twitter.github.com/bootstrap/">Twitter's
                    Bootstrap</a> by <a href="http://www.scotchmedia.com">Scotch
                    Media</a> -->
        </div>
    </div>


    <!-- disqus -->
    <script type="text/javascript">
        var disqus_title = '3. Capturing ROOT Errors with rootpy.logger &mdash; rootpy dev documentation';
        var disqus_identifier ='code' + '.' + "rootpy" + window.location.pathname.replace('/', '.');
    </script>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = "rootpy"; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


<script type="text/javascript">
    $('.nav .active').on('click', function () {
        e.preventDefault()
        $(this).siblings().toggle()
    });
</script>

<!-- plusone -->
<script type="text/javascript">
    (function () {
        var po = document.createElement('script');
        po.type = 'text/javascript';
        po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(po, s);
    })();
</script>

<!-- twitter -->
<script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>

</body>
</html>